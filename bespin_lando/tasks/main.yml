- name: Update apt cache
  apt: update_cache=yes

- name: Install pip
  apt: name={{item}}
  with_items:
    - python-pip

- pip:
    name: git+git://github.com/Duke-GCB/lando-messaging.git
    editable: false

- pip:
    name: git+git://github.com/Duke-GCB/lando.git
    editable: false

- name: Setup lando config
  blockinfile:
    dest: /etc/lando_config.yml
    block: "{{ bespin_lando.config }}"
    create: yes

- file:
    dest: /work
    state: directory
    owner: ubuntu
    mode: 0744

- name: Setup lando service
  blockinfile:
    dest: /etc/systemd/system/lando.service
    create: yes
    block: |
      [Unit]
      Description=Lando Service
      After=multi-user.target
      [Service]
      Type=idle
      ExecStart=/usr/local/bin/lando
      WorkingDirectory=/work
      User=ubuntu
      [Install]
      WantedBy=multi-user.target

- service:
    name: lando
    state: started
    enabled: yes
